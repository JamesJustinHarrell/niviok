<?xml version="1.0"?>
<?xml-stylesheet href="desible.css"?>

<!--

All 96 nodes:
access, alias, and, argument, array, assign, assign-replication, block, boolean, break, bundle, call, callee, case, cast, chain, class, class-property, comprehension, comprehension-type, conditional, continue, convertor, curry, declaration, declare-assign, declare-class, declare-const-empty, declare-empty, declare-first, dictionary, dictionary-entry, direction, do-times, do-while, enum, enum-entry, exception-handler, for-key, for-manual, for-pair, for-range, for-value, function, function-interface, generator, generic-class, generic-function, generic-interface, generic-parameter, extract-named-member, identifier, identifier-chain, identikey-category, identikey-type, ignore, ignore-member, implements, import, instantiate-generic-class, instantiate-generic-interface, intantiate-generic-function, integer, interface, interface-implementation, interface-member, labeled, loop, member-status, method, named-function, namespaced-identikey, nand, nor, or, parameter, plane, possibility, property, rational, replicate, return, select, set-property, statused-member, string, throw, try-catch, type, unassign, unassign-function, using, while, xnor, xor, yield

var map = Array.map;
var filter = Array.filter;

var elements = document.getElementsByTagName('*');
var ids = map(elements, function(element){ return element.getAttribute("id") || ""; });
var wantedIds = filter(ids, function(id){ return id.indexOf("node.") == 0; });
var nodeNames = map(wantedIds, function(id){ return id.substr(5); });
var sortedNodeNames = nodeNames.sort();

var container = document.createElement("p");
container.innerHTML = "All " + sortedNodeNames.length + " nodes:<br />\n";
container.appendChild(document.createTextNode(sortedNodeNames.join(", ")));
document.body.appendChild(container);

-->

<bundle xmlns="urn:desible1" version="1.0"
	xmlns:des="urn:desible1" xmlns:foo="http://site.com/stuff">
	
	<using>
		<identifier>std</identifier>
	</using>

	<inline-plane>
		<!--
		function header(title) {
			println("")
			println(title + " :")
		}
		-->
		<declare-first>
			<identifier label='name'>header</identifier>
			<identikey-type>
				<identikey-category>function</identikey-category>
				<nullable-type>
					<boolean label='nullable'>false</boolean>
				</nullable-type>
				<boolean label='constant'>true</boolean>
			</identikey-type>
			<function label='value'>
				<parameter>
					<nullable-type>
						<boolean label='nullable'>false</boolean>
					</nullable-type>
					<identifier label='name'>title</identifier>
					<boolean label='has-default-value'>false</boolean>
				</parameter>
				<block label='body'>
					<call>
						<identifier label='value'>println</identifier>
						<string label='argument'/>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<call label='argument'>
							<extract-named-member label='value'>
								<identifier label='source'>title</identifier>
								<identifier label='member-name'>concat</identifier>
							</extract-named-member>
							<string label='argument'> :</string>
						</call>
					</call>
				</block>
			</function>
		</declare-first>
		
		<!--
		function headerize(title, function) {
			header("calling " & title)
			function()
			println("")
			println("done with " & title)
		}
		-->
		<declare-first>
			<identifier label='name'>headerize</identifier>
			<identikey-type>
				<identikey-category>function</identikey-category>
				<nullable-type>
					<boolean label='nullable'>false</boolean>
				</nullable-type>
				<boolean label='constant'>true</boolean>
			</identikey-type>
			<function label='value'>
				<parameter>
					<nullable-type>
						<boolean label='nullable'>false</boolean>
					</nullable-type>
					<identifier label='name'>title</identifier>
					<boolean label='has-default-value'>false</boolean>
				</parameter>
				<parameter>
					<nullable-type>
						<boolean label='nullable'>false</boolean>
					</nullable-type>
					<identifier label='name'>function</identifier>
					<boolean label='has-default-value'>false</boolean>
				</parameter>
				<block label='body'>
					<call>
						<identifier label='value'>header</identifier>
						<call label='argument'>
							<extract-named-member label='value'>
								<string label='source'>calling </string>
								<identifier label='member-name'>concat</identifier>
							</extract-named-member>
							<identifier label='argument'>title</identifier>
						</call>
					</call>
					<call>
						<identifier label='value'>function</identifier>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<string label='argument'/>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<call label='argument'>
							<extract-named-member label='value'>
								<string label='source'>done with </string>
								<identifier label='member-name'>concat</identifier>
							</extract-named-member>
							<identifier label='argument'>title</identifier>
						</call>
					</call>
				</block>
			</function>
		</declare-first>
		
		<!--
		function main() {
			headerize("doStuff", doStuff)
			headerize("testNonProducers", testNonProducers)
			headerize("testSometimesProducers", testSometimesProducers)
			headerize("testAlwaysProducers", testAlwaysProducers)
		}
		-->
		<!-- the des prefix shouldn't affect anything -->
		<des:declare-first>
			<identifier label='name'>main</identifier>
			<identikey-type>
				<identikey-category>function</identikey-category>
				<nullable-type>
					<boolean label='nullable'>false</boolean>
				</nullable-type>
				<boolean label='constant'>true</boolean>
			</identikey-type>
			<function label='value'>
				<!-- the foo:label shouldn't affect anything -->
				<block foo:label="stuff" label='body'>
					
					<!-- doStuff -->
					<call>
						<identifier label='value'>headerize</identifier>
						<string label='argument'>doStuff</string>
						<!-- the des:label attribute shouldn't affect anything, since non-namespaced attributes are used -->
						<identifier label='argument' des:label='foo'>doStuff</identifier>
					</call>
					
					<!-- testNonProducers -->
					<call>
						<identifier label='value'>headerize</identifier>
						<string label='argument'>testNonProducers</string>
						<identifier label='argument'>testNonProducers</identifier>
					</call>
					
					<!-- testSometimesProducers -->
					<call>
						<identifier label='value'>headerize</identifier>
						<string label='argument'>testSometimesProducers</string>
						<identifier label='argument'>testSometimesProducers</identifier>
					</call>
					
					<!-- testAlwaysProducers -->
					<call>
						<identifier label='value'>headerize</identifier>
						<string label='argument'>testAlwaysProducers</string>
						<identifier label='argument'>testAlwaysProducers</identifier>
					</call>
		
					<!-- this should be ignored since it's in a different namespace -->
					<foo:ignored-stuff>
						<candy>
							ABC
							<apple>
								<cinnamon/>
								DEF
							</apple>
						</candy>
					</foo:ignored-stuff>
				</block>
			</function>
		</des:declare-first>
		
		<!--
		function doStuff() {
			if true {
				println("this is a test")
			}
			string str = "ðŸ¿° Hello,".concat(" World ðŸ¿±")
			println(str)
			println(str.length)
			for x from 1 to 20  {
				println( x.add(10000) )
			}
		}
		-->
		<declare-first>
			<identifier label='name'>doStuff</identifier>
			<identikey-type>
				<identikey-category>function</identikey-category>
				<nullable-type>
					<boolean label='nullable'>false</boolean>
				</nullable-type>
				<boolean label='constant'>true</boolean>
			</identikey-type>
			<function label='value'>
				<block label='body'>
					<possibility>
						<identifier label='test'>true</identifier>
						<block label='result'>
							<call>
								<identifier label='value'>println</identifier>
								<string label='argument'>this is a test</string>
							</call>
						</block>
					</possibility>
					<declare-assign>
						<identifier label='name'>str</identifier>
						<identikey-type>
							<identikey-category>strict</identikey-category>
							<nullable-type>
								<identifier label='interface'>String</identifier>
								<boolean label='nullable'>false</boolean>
							</nullable-type>
							<boolean label='constant'>true</boolean>
						</identikey-type>
						<call label='value'>
							<extract-named-member label='value'>
								<string label='source'>&#x1FFF0; Hello,</string>
								<identifier label='member-name'>concat</identifier>
							</extract-named-member>
							<string label='argument'> World &#x1FFF1;</string>
						</call>
					</declare-assign>
					<call>
						<identifier label='value'>println</identifier>
						<identifier label='argument'>str</identifier>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<extract-named-member label='argument'>
							<identifier label='source'>str</identifier>
							<identifier label='member-name'>length</identifier>
						</extract-named-member>
					</call>
					<for-range>
						<identifier>x</identifier>
						<integer label='start'>1</integer>
						<integer label='limit'>20</integer>
						<block>
							<call>
								<identifier label='value'>println</identifier>
								<call label='argument'>
									<extract-named-member label='value'>
										<identifier label='source'>x</identifier>
										<identifier label='member-name'>add</identifier>
									</extract-named-member>
									<integer label='argument'>10000</integer>
								</call>
							</call>
						</block>
					</for-range>
				</block>
			</function>
		</declare-first>

		<!--
		function testNonProducers() {
		}
		-->
		<declare-first>
			<identifier label='name'>testNonProducers</identifier>
			<identikey-type>
				<identikey-category>function</identikey-category>
				<nullable-type>
					<boolean label='nullable'>false</boolean>
				</nullable-type>
				<boolean label='constant'>true</boolean>
			</identikey-type>
			<function label='value'>
				<block label='body'>
				</block>
			</function>
		</declare-first>
		
		<!--
		function testSometimesProducers() {
		}
		-->
		<declare-first>
			<identifier label='name'>testSometimesProducers</identifier>
			<identikey-type>
				<identikey-category>function</identikey-category>
				<nullable-type>
					<boolean label='nullable'>false</boolean>
				</nullable-type>
				<boolean label='constant'>true</boolean>
			</identikey-type>
			<function label='value'>
				<block label='body'>
				</block>
			</function>
		</declare-first>
		
		<!--
		function testAlwaysProducers() {
			header("testBooleanLogic()")
			testBooleanLogic()

			header("active-interface")
			println( activeInterface(true) == Bool )
			
			//header("array")
			//println( array Int { 1, 2, 3, 4 } )
			
			header("function")
			println( (function(){ return "some stuff" })() )
			
			header("identifier")
			println( true )
			
			header("rational")
			println( 123.456 )
			
			header("string")
			println( "This is some text." )
		}
		-->
		<declare-first>
			<identifier label='name'>testAlwaysProducers</identifier>
			<identikey-type>
				<identikey-category>function</identikey-category>
				<nullable-type>
					<boolean label='nullable'>false</boolean>
				</nullable-type>
				<boolean label='constant'>true</boolean>
			</identikey-type>
			<function label='value'>
				<block label='body'>
					
					<!-- testBooleanLogic() -->
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>testBooleanLogic()</string>
					</call>
					<call>
						<identifier label='value'>testBooleanLogic</identifier>
					</call>
					
					<!-- array - -> xxx generic interface implementations needed
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>array</string>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<array label='argument'>
							<integer label='element'>1</integer>
						</array>
					</call>
					-->
					
					<!-- cast -->
					<!-- chain -->
					<!-- class -->
					<!-- comprehension -->
					<!-- copy -->
					<!-- convert (should make println easier to implement, untill Stringable and other toWhatever interfaces are automatically inherited) -->
					<!-- dictionary -->
					<!-- enum -->
					
					<!-- function -->
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>function</string>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<call label='argument'>
							<function label='value'>
								<string label='body'>some stuff</string>
							</function>
						</call>
					</call>

					<!-- function-interface -->
					<!-- generator -->
					<!-- generic-class -->
					<!-- generic-function -->
					<!-- generic-interface -->
					<!-- extract-named-member -->

					<!-- identifier -->
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>identifier</string>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<identifier label='argument'>true</identifier>
					</call>
					
					<!-- instantiate-generic-class -->
					<!-- instantiate-generic-function -->
					<!-- instantiate-generic-interface -->
					<!-- implements -->
					
					<!-- integer -->
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>integer</string>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<integer label='argument'>9000</integer>
					</call>
					
					<!-- interface -->
					<!-- namespaced-identikey -->
					
					<!-- rational -->
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>rational</string>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<rational label='argument'>123.456</rational>
					</call>
					
					<!-- set-property -->
					
					<!-- string -->
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>string</string>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<string label='argument'>This is some text.</string>
					</call>
				</block>
			</function>
		</declare-first>
		
		<!--
		function testBooleanLogic() {
			decl t = true
			decl f = false
		
			//for (n)and and (n)or: shortcut, then not shortcut

			header("and")
			println( f and t )
			println( t and t )

			header("nand")
			println( f nand t )
			println( t nand t )

			header("or")
			println( t or f )
			println( f or f )

			header("nor")
			println( t nor f )
			println( f nor f )
			
			header("xor")
			println( t xor f )
			println( t xor t )
			
			header("xnor")
			println( t xnor f )
			println( t xnor t )
		}
		-->
		<declare-first>
			<identifier label='name'>testBooleanLogic</identifier>
			<identikey-type>
				<identikey-category>function</identikey-category>
				<nullable-type>
					<boolean label='nullable'>false</boolean>
				</nullable-type>
				<boolean label='constant'>true</boolean>
			</identikey-type>
			<function label='value'>
				<block label='body'>
					
					<!-- decl t = true -->
					<declare-assign>
						<identikey-type>
							<identikey-category>automatic</identikey-category>
							<nullable-type>
								<boolean label='nullable'>false</boolean>
							</nullable-type>
							<boolean label='constant'>true</boolean>
						</identikey-type>
						<identifier label='name'>t</identifier>
						<identifier label='value'>true</identifier>
					</declare-assign>
					
					<!-- decl f = false -->
					<declare-assign>
						<identikey-type>
							<identikey-category>automatic</identikey-category>
							<nullable-type>
								<boolean label='nullable'>false</boolean>
							</nullable-type>
							<boolean label='constant'>true</boolean>
						</identikey-type>
						<identifier label='name'>f</identifier>
						<identifier label='value'>false</identifier>
					</declare-assign>
					
					<!-- and -->
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>and</string>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<and label='argument'>
							<identifier label='first'>f</identifier>
							<identifier label='second'>t</identifier>
						</and>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<and label='argument'>
							<identifier label='first'>t</identifier>
							<identifier label='second'>t</identifier>
						</and>
					</call>
					
					<!-- nand -->
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>nand</string>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<nand label='argument'>
							<identifier label='first'>f</identifier>
							<identifier label='second'>t</identifier>
						</nand>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<nand label='argument'>
							<identifier label='first'>t</identifier>
							<identifier label='second'>t</identifier>
						</nand>
					</call>
					
					<!-- or -->
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>or</string>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<or label='argument'>
							<identifier label='first'>f</identifier>
							<identifier label='second'>t</identifier>
						</or>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<or label='argument'>
							<identifier label='first'>f</identifier>
							<identifier label='second'>f</identifier>
						</or>
					</call>
					
					<!-- nor -->
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>nor</string>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<nor label='argument'>
							<identifier label='first'>f</identifier>
							<identifier label='second'>t</identifier>
						</nor>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<nor label='argument'>
							<identifier label='first'>f</identifier>
							<identifier label='second'>f</identifier>
						</nor>
					</call>
					
					<!-- xor -->
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>xor</string>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<xor label='argument'>
							<identifier label='first'>t</identifier>
							<identifier label='second'>f</identifier>
						</xor>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<xor label='argument'>
							<identifier label='first'>t</identifier>
							<identifier label='second'>t</identifier>
						</xor>
					</call>
					
					<!-- xnor -->
					<call>
						<identifier label='value'>header</identifier>
						<string label='argument'>xnor</string>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<xnor label='argument'>
							<identifier label='first'>t</identifier>
							<identifier label='second'>f</identifier>
						</xnor>
					</call>
					<call>
						<identifier label='value'>println</identifier>
						<xnor label='argument'>
							<identifier label='first'>t</identifier>
							<identifier label='second'>t</identifier>
						</xnor>
					</call>
					
				</block>
			</function>
		</declare-first>
			
	</inline-plane>
	
</bundle>